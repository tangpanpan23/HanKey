<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ æ±‰å­—å¯»å®å¼•æ“ Â· 15åˆ†é’Ÿè§£è°œæ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .result {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }

        .result h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .insight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .loading {
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .treasure-map {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            white-space: pre-wrap;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ æ±‰å­—å¯»å®å¼•æ“</h1>
            <p>15åˆ†é’Ÿå†…ï¼Œå¬æ‡‚20+æ—¥éŸ©è¯­è¯æ±‡çš„AIè§£è°œæ¸¸æˆ</p>
        </div>

        <!-- è¯æ ¹è§£é”ä»ªå¼ -->
        <div class="card">
            <h2>ğŸ¯ ç¬¬ä¸€é˜¶æ®µï¼šè¯æ ¹è§£é”ä»ªå¼</h2>
            <p style="margin-bottom: 20px; color: #666;">è¾“å…¥ä»»æ„3ä¸ªä¸­æ–‡è¯è¯­ï¼Œå¼€å¯ä½ çš„æ±‰å­—å¯»å®ä¹‹æ—…ï¼</p>

            <div class="input-group">
                <label for="words">è¾“å…¥ä¸­æ–‡è¯è¯­ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰:</label>
                <input type="text" id="words" class="input-field"
                       placeholder="ä¾‹å¦‚ï¼šç”µè¯ï¼Œå‘ç°ï¼Œå›¾ä¹¦é¦†"
                       value="ç”µè¯,å‘ç°,å›¾ä¹¦é¦†">
            </div>

            <button class="btn" onclick="unlockRoots()">ğŸ” å¼€å§‹è¯æ ¹è§£é”ä»ªå¼</button>

            <div id="unlock-result" class="result" style="display: none;">
                <h3>âœ¨ è§£é”ç»“æœ</h3>
                <div id="insights"></div>
            </div>
        </div>

        <!-- è§£è°œå…³å¡ -->
        <div class="card">
            <h2>ğŸ§© ç¬¬äºŒé˜¶æ®µï¼šæ™ºèƒ½è§£è°œå…³å¡</h2>
            <p style="margin-bottom: 20px; color: #666;">é€šè¿‡è§£è°œæ¥è§£é”æ›´å¤šæ—¥éŸ©è¯­è¯æ±‡ï¼</p>

            <button class="btn" onclick="startLevel('pronunciation')">ğŸµ éŸ³è¯»ç ´è¯‘å®¤</button>
            <button class="btn" onclick="startLevel('listening')" style="margin-top: 10px;">ğŸ§ éŸ©è¯­å¬åŠ›ä¾¦æ¢</button>
            <button class="btn" onclick="startLevel('dialect')" style="margin-top: 10px;">ğŸ—ºï¸ æ–¹è¨€è¿æ¥å½©è›‹</button>

            <div id="level-content" style="display: none;">
                <div id="level-result" class="result">
                    <h3>ğŸ¯ å…³å¡æŒ‘æˆ˜</h3>
                    <div id="level-question"></div>
                    <div id="level-options" style="margin-top: 15px;"></div>
                    <button class="btn" onclick="submitAnswer()" style="margin-top: 15px;">æäº¤ç­”æ¡ˆ</button>
                </div>
            </div>
        </div>

        <!-- è—å®å›¾ -->
        <div class="card">
            <h2>ğŸ† ç¬¬ä¸‰é˜¶æ®µï¼šæˆ‘çš„è¯æ ¹è—å®å›¾</h2>
            <p style="margin-bottom: 20px; color: #666;">æŸ¥çœ‹ä½ çš„è§£è°œæˆæœå’Œå­¦ä¹ è¿›åº¦ï¼</p>

            <button class="btn" onclick="showTreasureMap()">ğŸ“Š ç”Ÿæˆè—å®å›¾</button>

            <div id="treasure-map" style="display: none;">
                <div id="stats" class="stats"></div>
                <div id="map-content" class="treasure-map"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';

        // è¯æ ¹è§£é”ä»ªå¼
        async function unlockRoots() {
            const wordsInput = document.getElementById('words').value;
            const words = wordsInput.split(',').map(w => w.trim()).filter(w => w);

            if (words.length < 1) {
                alert('è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªè¯è¯­');
                return;
            }

            showLoading('unlock-result', true);

            try {
                const response = await fetch(`${API_BASE}/api/v1/hanbao/unlock`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ words: words }),
                });

                const result = await response.json();

                displayUnlockResult(result);
            } catch (error) {
                console.error('è§£é”å¤±è´¥:', error);
                alert('è§£é”å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }

            showLoading('unlock-result', false);
        }

        function displayUnlockResult(result) {
            const container = document.getElementById('insights');
            container.innerHTML = '';

            result.insights.forEach(insight => {
                const div = document.createElement('div');
                div.className = 'insight';
                div.textContent = insight;
                container.appendChild(div);
            });

            document.getElementById('unlock-result').style.display = 'block';
        }

        // å…³å¡ç³»ç»Ÿ
        async function startLevel(levelType) {
            const levelId = `${levelType}_1_1`; // ç¤ºä¾‹å…³å¡ID

            try {
                const response = await fetch(`${API_BASE}/api/v1/hanbao/level/${levelId}`);
                const level = await response.json();

                displayLevel(level);
            } catch (error) {
                console.error('è·å–å…³å¡å¤±è´¥:', error);
                alert('è·å–å…³å¡å¤±è´¥');
            }
        }

        function displayLevel(level) {
            const questionDiv = document.getElementById('level-question');
            const optionsDiv = document.getElementById('level-options');

            if (level.questions && level.questions.length > 0) {
                const question = level.questions[0];
                questionDiv.innerHTML = `<h4>${level.title}</h4><p>${question.content}</p>`;

                if (question.options && question.options.length > 0) {
                    optionsDiv.innerHTML = question.options.map((option, index) =>
                        `<label style="display: block; margin: 5px 0;">
                            <input type="radio" name="answer" value="${option}" style="margin-right: 10px;">
                            ${option}
                        </label>`
                    ).join('');
                }
            }

            document.getElementById('level-content').style.display = 'block';
        }

        async function submitAnswer() {
            const selectedOption = document.querySelector('input[name="answer"]:checked');
            if (!selectedOption) {
                alert('è¯·é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆ');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/v1/hanbao/level/example/answer`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        question_id: 'q1',
                        answer: selectedOption.value
                    }),
                });

                const result = await response.json();

                alert(result.correct ? `æ­£ç¡®ï¼${result.explanation}` : `é”™è¯¯ï¼${result.explanation}`);
            } catch (error) {
                console.error('æäº¤ç­”æ¡ˆå¤±è´¥:', error);
                alert('æäº¤ç­”æ¡ˆå¤±è´¥');
            }
        }

        // è—å®å›¾
        async function showTreasureMap() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/hanbao/session/demo-session/treasure-map`);
                const treasureMap = await response.json();

                displayTreasureMap(treasureMap);
            } catch (error) {
                console.error('è·å–è—å®å›¾å¤±è´¥:', error);
                alert('è·å–è—å®å›¾å¤±è´¥');
            }
        }

        function displayTreasureMap(treasureMap) {
            // æ˜¾ç¤ºç»Ÿè®¡æ•°æ®
            const statsDiv = document.getElementById('stats');
            statsDiv.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${treasureMap.stats.unlocked_roots}</div>
                    <div class="stat-label">å·²è§£é”å­—æ ¹</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${treasureMap.stats.total_words}</div>
                    <div class="stat-label">æŒæ¡è¯æ±‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${treasureMap.stats.accuracy}%</div>
                    <div class="stat-label">å‡†ç¡®ç‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${treasureMap.achievements.length}</div>
                    <div class="stat-label">è·å¾—æˆå°±</div>
                </div>
            `;

            // ç”Ÿæˆæ–‡å­—æŠ¥å‘Š
            const report = generateTextReport(treasureMap);
            document.getElementById('map-content').textContent = report;

            document.getElementById('treasure-map').style.display = 'block';
        }

        function generateTextReport(treasureMap) {
            let report = `ğŸ¯ 15åˆ†é’Ÿæˆ˜æŠ¥\n\n`;
            report += `âœ… å·²è§£é”å­—æ ¹ï¼š${treasureMap.stats.unlocked_roots}ä¸ª\n`;
            report += `âœ… å·²æŒæ¡è¯æ±‡ï¼šæ—¥è¯­${treasureMap.stats.total_words}ä¸ª\n`;
            report += `âœ… è§£å¯†å‡†ç¡®ç‡ï¼š${treasureMap.stats.accuracy}%\n`;
            report += `ğŸ”¥ è§£é”æˆå°±ï¼š${treasureMap.achievements.length}ä¸ª\n\n`;

            report += `ğŸ“Š è¯æ ¹ç½‘ç»œé¢„è§ˆï¼š\n\n`;

            // æ˜¾ç¤ºå­—æ ¹å’Œè¯æ±‡
            Object.keys(treasureMap.vocabularies).forEach(root => {
                report += `ã€${root}ã€‘â”€â”¬â”€ `;
                const vocabs = treasureMap.vocabularies[root];
                if (vocabs && vocabs.length > 0) {
                    vocabs.slice(0, 2).forEach((vocab, index) => {
                        const display = vocab.language === 'ja' ?
                            `${vocab.word}ï¼ˆ${vocab.romaji}ï¼‰` :
                            `${vocab.word}ï¼ˆ${vocab.pronunciation}ï¼‰`;
                        report += display;
                        if (index < vocabs.slice(0, 2).length - 1) {
                            report += '\n      â”œâ”€ ';
                        }
                    });
                }
                report += '\n\n';
            });

            if (treasureMap.achievements && treasureMap.achievements.length > 0) {
                report += `ğŸ† è·å¾—æˆå°±ï¼š\n`;
                treasureMap.achievements.forEach(achievement => {
                    report += `â€¢ ${achievement.name} - ${achievement.description}\n`;
                });
            }

            report += `\nğŸš€ ä¸‹ä¸€ç«™å»ºè®®ï¼š\nç»§ç»­è§£è°œï¼Œç‚¹äº®æ•´å¼ æ±‰å­—ç½‘ç»œï¼`;

            return report;
        }

        function showLoading(elementId, show) {
            const element = document.getElementById(elementId);
            if (show) {
                element.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>AIæ­£åœ¨åˆ†æä¸­...</p>
                    </div>
                `;
                element.style.display = 'block';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        window.onload = function() {
            console.log('ğŸš€ æ±‰å­—å¯»å®å¼•æ“æ¼”ç¤ºé¡µé¢å·²åŠ è½½');
            console.log('ğŸ“ APIæœåŠ¡åœ°å€: http://localhost:8080');
        };
    </script>
</body>
</html>
